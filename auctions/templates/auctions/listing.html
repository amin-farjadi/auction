{% extends "auctions/layout.html" %}

{% block body%}
{% if listing %}
<div>
    {% if user.is_authenticated %}
        <form action="{% url 'listing' listing.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" name= {{ wishlist_form_name }} value="wishlist">{{ wishlist_form_text }}</button>
        </form>        
    {% endif %}
</div>

{% if user.id == listing.created_by.id and not listing.closed %}
    <div>
        <form action="{% url 'listing' listing.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" name="close_listing" value="">Close listing</button>
        </form>
    </div>
    {% elif listing.closed %}
    <div>    
        <h4>Listing is closed</h4>
    </div>
{% endif %}


<div>
    {% if listing.image %} 
        <img src= "{{listing.image.url}}" alt="{{listing.title}}" style="max-height:300px; max-width: 300px;">
    {% else %}
        <img src= "/media/images/default.jpg" alt="Default Image" style="max-height:300px; max-width: 300px;">
    {% endif %}
    {{listing.id}}: {{ listing.title }}, {{ listing.price }}
</div>
<div>
    Bids:
    <ul>
        {% for bid in bids %}
            <li>{{bid.bid}}</li>
        {% empty %}
            <li>No bid.</li>
        {% endfor %}
    </ul>
</div>

{% if not listing.closed and user.is_authenticated %}
<div>
    {% if bid_error is not none %}   
        {{ bid_error }}
    {% endif %}
    <form action="{% url 'listing' listing.id %}" method="POST">
        {% csrf_token %}

        {{bid_form.as_p}}

        <!-- {% endif %} -->
        <button type="submit" name="add_bid" value="bid">Add</button>
    </form>
</div>
{% endif %}

{% if listing.closed %}
    <h3>Auction is closed on this listing.</h3>
    {% if not auction_winner is None and user.id == auction_winner.id %}
        <h3>You won the auction</h3>
    {% endif %}
{% endif %}
<div>
    Comments:
    <ul>
        {% for comment in comments %}
            <li>{{comment.comment}}</li>
        {% empty %}
            <li>No comment</li>
        {% endfor %}
    </ul>
</div>

{% if user.is_authenticated %}
<div>
    <form action="{% url 'listing' listing.id %}" method="POST">
        {% csrf_token %}
        {{comment_form}}
        <button type="submit" name="add_comment" value="comment">Add</button>
    </form>
</div>

{% else %}
    <h3>No listing with that ID.</h3>

{% endif %}

{% endblock %}